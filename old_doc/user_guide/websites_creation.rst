Website creation
================

Open Orchestra is multisite and allows to create several websites from the same Back Office application.

Creating a new site with Open Orchestra requires four steps. Additionally, you can add some more
steps to enhance the site features. Those steps are the following:

* Declaring the website in Open Orchestra
* Dealing with access rights
* Contributing the home page
* Configuring the webserver
* (Optional) Configure the 404 & 503 pages
* (Optional) Generate the robots.txt
* (Optional) Generate the sitemap.xml

Declaring the site
------------------
The first thing to do is to declare the site in Open Orchestra by filling the website creation form.

Name (required)
```````````````

The name field is the website name and is used to generate the website identifier.

Website id (required)
`````````````````````
.. image:: ../../images/website_id.png

The website id can be generated by Open Orchestra from the site name or filled by the user when
creating the site.
Once the site created, this field is no more editable.
Open Orchestra verifies during the form validation that the site id does not already exist as it
must be unique among all the sites.

Aliases
```````
.. image:: ../../images/aliases.png

A site may exist in different languages, and each of this versions could have minor differences, for
instance a node could be published in English and not in French. Moreover, a site in English could be
accessed from different domains. To make the management of those problematics easier, Open Orchestra
introduces the concept of site alias.
Basically a site represents a set of site aliases sharing contents and pages, each site alias in a
single language. Multiple site aliases can be configured with the same language, if they define
different access points, eg domain + language prefix.

For instance, the site http://demo.open-orchestra.com/ exists in english and french. It presents two
site aliases:

* Scheme by default (required): http
* Domain (required): demo.openorchestra.com
* Language (required): English
* Language prefix : en
* main aliases : on

* Scheme by default (required): http
* Domain (required): demo.openorchestra.com
* Language (required): French
* Language prefix :
* main aliases : off

The website home page for english version is ``http://demo.openorchestra.com/en`` and
``http://demo.openorchestra.com`` for the french version.

See the `routing documentation`_ for further information.

Blocks available
````````````````
.. image:: ../../images/blocks_available.png

This field lists all the blocks available to nodes contribution for this website.
Only the selected blocks will be available.

Default Theme (required)
````````````````````````

The field theme is the default theme used by the website.
This setting can be overridden node by node in order to have a specific theme on a special node.

Sitemap generation (required)
`````````````````````````````

The two following settings are related to the sitemap.xml generation. Those settings are used as
default values for all nodes of the site, but they can be overridden node by node.

* Indicative periodicity of change of the page
* Relative importance compared to the other pages of the website

Meta
````
.. image:: ../../images/meta.png

The meta attributes are set in the HTML header of a web page to provide information about the nature
and content of the page.
The settings contributed here are default values for each node of the site, but can be overridden
node by node.

Meta keyword
````````````

This is a list of keywords associated to the page and can be used by search engines for ranking.

Meta description
````````````````

This is used by search engines to display a description of the page in the results list.

Meta index
``````````

This attribute defines whether or not the page should be referenced in search engines.

Meta follow
```````````

This attribute indicates to search engines if they should follow hypertext links encountered in
the page to index linked documents.

Information contained in the robots.txt file (required)
```````````````````````````````````````````````````````

This field contains the data of the robots.txt file.

robots.txt file example
```````````````````````

    User-agent: *
    Allow: /

User-agent: * means that one or several instruction (s) which follow applies for all the agents.
Allow: / means that the search engine can browse all the directories and the pages of the site.

Homepage template
`````````````````

Template used to create the homepage of your new website.

Dealing with access rights
--------------------------
To be able to contribute to the site, access rights have to be set. To do this, create a new group
including several roles related to this site (including ROLE_ACCESS_TREE_NODE) and assign it to the
newly created site.

Once this is done, you can add users to the group by editing them. On their next connection, these
users will be able to select that site with the site switcher.

.. image:: ../../images/site_switcher.png

Further information on group contribution is available in the user guide, on `user page`_

Configuring the webserver
-------------------------
Now, Open Orchestra knows about your site and a first page is contributed. The last thing to do is
to get that page reachable. To do this you have to configure your webserver. The type of
configuration depends on you server type, for instance on Apache this is done via the Virtual Host
mechanism. Here is a simple example in a such context:

.. code-block: apache

    <VirtualHost *:80>
        ServerAdmin webmaster@mysite.com
        ServerName mysite.com

        DocumentRoot /absolute/path/to/Open/Orchestra/web
        <Directory /absolute/path/to/Open/Orchestra/web>
            Options -Indexes +FollowSymLinks -MultiViews
            AllowOverride All
            Order allow,deny
            allow from all
        </Directory>

        ErrorLog /absolute/path/to/logs/mysite.openorchestra.error.log
        CustomLog /absolute/path/to/logs/mysite.openorchestra.access.log combined
    </VirtualHost>


Note that the DocumentRoot must point to the web directory of Open Orchestra installation, not on
the Open Orchestra root directory.

Once Apache reloaded, your new website should be accessible.

*Note:* According to your environment, be sure to call the right front controller when testing the
access (eg app_dev.php, app_prod.php, etc ...).


(Optional) Configure the 404 & 503 pages
----------------------------------------
At this stage, your site is visible. But it's the minimum and you can add several optional features.
For instance, you can customize the 404 and 503 pages to map them to your site design. The
`documentation on error pages`_ shows how to do that.

(Optional) Generate the robots.txt
----------------------------------
Additionally, you can generate the robot.txt file according to the setting configured previously
in the website form. See `Robots.txt documentation`_ for more information about this.

(Optional) Generate the sitemap.xml
-----------------------------------
You may also want to generate the sitemap.xml of your site. To do this you can run a simple command
line. See `Sitemap.xml documentation`_ for more information about this.

.. _website creation page: ../user_guide/websites_creation.html
.. _user page: ../user_guide/user.html
.. _node page: ../user_guide/node.html
.. _node configuration page: ../user_guide/node_configuration.html
.. _documentation on error pages: ../developer_guide/error_pages.html
.. _`Robots.txt documentation`: ../developer_guide/robots.html
.. _`Sitemap.xml documentation`: ../developer_guide/sitemap.html
.. _routing documentation: ../developer_guide/routing.html
